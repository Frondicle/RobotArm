#code generated with Grasshopper for Rhino
#Chris Morrey

import os
import sys
import time
import math

sys.path.append("C:\\Users\\morr0289\\Documents\\Github\\RobotArm\\Python\\")

from arm_sdk3.xarm.wrapper.xarm_api import XArmAPI
arm = XArmAPI('192.168.1.196')
id = 9
baudRate = 9600
#arm.set_tcp_load()  DO THIS*****************************
#arm.set_tcp_offset()
#arm.set_collision_tool_model
arm.motion_enable(True)
arm.set_mode(0)
arm.set_state(0)

if arm.warn_code != 0:
    arm.clean_warn()
if arm.error_code != 0:
    arm.clean_error()
time.sleep(2)

ret = arm.core.set_modbus_timeout(5)  
print('set modbus timeout, ret = %d' % (ret[0]))    
ret = arm.core.set_modbus_baudrate(baudRate)  
print('set modbus baudrate, ret = %d' % (ret[0]))

time.sleep(1)

def sender(data_frame):
    code, digitals = arm.get_tgpio_digital()
    while arm.connected and arm.error_code != 19 and arm.error_code != 28:
        if code == 0 and digitals[0] == 1:
            ret = arm.getset_tgpio_modbus_data(data_frame,host_id=id,min_res_len=12)#core??
            if digitals [0] == 0:
                print('extruder reports not ready')
            if ret[0] == 1:
                print('uncleared error exists')
            if ret[0] == 0:
                print('seems good')
            if ret[0] == 23:
                print('wrong reply length: ',len(ret[1]),' bytes')
            if ret[0] == 20:
                print('wrong slave id')
            if ret[0] == 15:
                print('Modbus commands full')
            if ret[0] == 19:
                print('communication error')
            if ret[0] == 28:
                print('communication error')
            time.sleep(.01)

arm.motion_enable(enable=True)
arm.set_mode(0)
arm.set_state(state=0)

last_digitals = [-1, -1]

arm.reset(wait=True)

while arm.connected and arm.error_code ==0:


    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0xa4, 0x00,0x1f, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x14, 0x03,0x63, 0x05,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x78, 0x06,0x52, 0x0b,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0xa4, 0x01,0xdf, 0x02,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x14, 0x09,0xe3, 0x0f,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x66, 0x01,0x72, 0x02,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x0b, 0x0b,0x53, 0x13,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x48, 0x01,0x3f, 0x02,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0xa9, 0x0c,0x29, 0x16,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x37, 0x01,0x20, 0x02,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x0f, 0x0e,0x9a, 0x18,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x2b, 0x01,0x0c, 0x02,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x4a, 0x0f,0xc2, 0x1a,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x23, 0x01,0xfd, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x64, 0x10,0xb0, 0x1c,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x1d, 0x01,0xf3, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x64, 0x11,0x6f, 0x1e,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x18, 0x01,0xea, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x4d, 0x12,0x07, 0x20,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x14, 0x01,0xe3, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x23, 0x13,0x7d, 0x21,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x11, 0x01,0xde, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0xe8, 0x13,0xd6, 0x22,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x0e, 0x01,0xd9, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x9d, 0x14,0x14, 0x24,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x0c, 0x01,0xd5, 0x01,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x45, 0x15,0x3a, 0x25,0x00,0x01]
    sender(datas)
    datas = [0x09,0x10,0x00,0x00,0x00,0x03,0x06,0x0a, 0x01,0xd2, 0x01,0x00,0x01]
    sender(datas)
arm.disconnect()
